# Source https://github.com/MazeMap/Leaflet.TileLayer.PouchDBCached
tileLayer.PouchDBCachedDependency <- function() {
  # list(
  #   htmltools::htmlDependency(
  #     "tileLayer.PouchDBCached",version = "0.1.1",
  #     system.file("htmlwidgets/lib/TileLayer.PouchDBCached", package = "leaflet.extras"),
  #     script = c("pouchdb-6.0.7.js","L.TileLayer.PouchDBCached.js")
  #   )
  # )
  list(
    # // "pouchdb-browser": "6.4.3",
    html_dep_prod("pouchdb-browser", "6.4.3"),
    # // "leaflet.tilelayer.pouchdbcached": "nikolauskrismer/Leaflet.TileLayer.PouchDBCached#a92b176",
    html_dep_prod("leaflet-tilelayer", "0.3.0")
  )
}

#' Enables caching of Tiles
#' @description Enables caching of tiles locally in browser. See \url{https://github.com/MazeMap/Leaflet.TileLayer.PouchDBCached} for details. In addition to invoking this function, you should also pass \code{useCache=TRUE} & \code{crossOrigin=TRUE} in the \code{\link[leaflet]{tileOptions}} call and pass that to your \code{\link[leaflet]{addTiles}}'s \code{options} parameter.
#' @param map The leaflet map
#' @rdname TileCaching
#' @export
#' @examples
#' leaflet() %>%
#'   enableTileCaching() %>%
#'   addTiles(options = tileOptions(useCache = TRUE, crossOrigin = TRUE))
#'
#' ## for more examples see
#' # browseURL(system.file("examples/TileLayer-Caching.R", package = "leaflet.extras"))
enableTileCaching <- function(map) {
  map$dependencies <- c(map$dependencies, tileLayer.PouchDBCachedDependency())
  map
}
